<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë”¸ê¸°ë¥¼ í”¼í•´ë¼!</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #ffe0f0;
      font-family: "Arial", sans-serif;
    }

    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .character {
      position: absolute;
      font-size: 40px;
      pointer-events: none;
      transition: transform 0.05s linear;
    }

    .falling {
      position: absolute;
      font-size: 32px;
      animation: fall linear;
    }

    @keyframes fall {
      from {
        top: -50px;
      }
      to {
        top: 100vh;
      }
    }

    #timer {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      background: #fff0f7;
      padding: 6px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      user-select: none;
    }

    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      color: #ff4d88;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: none;
      text-align: center;
      user-select: none;
    }

    #strawberry-count {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
      background: #fff0f7;
      padding: 6px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      user-select: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    #shop-button {
      position: absolute;
      bottom: 20px;
      right: 20px;
      padding: 10px 16px;
      background: #ff4d88;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      cursor: pointer;
      user-select: none;
      box-shadow: 0 3px 8px rgba(255, 77, 136, 0.7);
      transition: background 0.3s;
    }
    #shop-button:hover {
      background: #e63f78;
    }

    /* ìƒì  ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    #shop-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      padding: 20px;
      width: 90vw;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      display: none;
      z-index: 1000;
    }
    #shop-modal h2 {
      margin-top: 0;
      margin-bottom: 12px;
      text-align: center;
      color: #ff4d88;
    }
    .shop-section {
      margin-bottom: 20px;
    }
    .shop-items {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }
    .shop-item {
      cursor: pointer;
      padding: 10px 14px;
      border-radius: 12px;
      border: 2px solid transparent;
      font-size: 30px;
      user-select: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 80px;
      box-sizing: border-box;
      transition: border-color 0.3s, background-color 0.3s;
      position: relative;
    }
    .shop-item.selected {
      border-color: #ff4d88;
      background-color: #fff0f7;
    }
    .shop-item .price {
      font-size: 14px;
      color: #888;
      margin-top: 6px;
      user-select: none;
    }
    .shop-item.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    #close-shop {
      display: block;
      margin: 0 auto;
      padding: 8px 18px;
      font-size: 16px;
      border: none;
      background: #ff4d88;
      color: white;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
    }
    #close-shop:hover {
      background: #e63f78;
    }

    /* ë”¸ê¸° ì•„ì´ì½˜ í‘œì‹œ */
    #strawberry-count span {
      font-size: 24px;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="timer">00:00</div>
    <div id="strawberry-count">ğŸ“ <span id="strawberry-num">0</span></div>
    <div id="player" class="character">ğŸ‘©ğŸ»â€ğŸ³</div>
    <div id="game-over"></div>
    <button id="shop-button" type="button">ìƒì </button>
  </div>

  <div id="shop-modal" role="dialog" aria-modal="true" aria-labelledby="shop-title">
    <h2 id="shop-title">ìƒì </h2>

    <div class="shop-section" id="icon-shop">
      <h3>ì•„ì´ì½˜</h3>
      <div class="shop-items" id="icon-items">
        <!-- ì•„ì´ì½˜ ì•„ì´í…œ ë™ì  ìƒì„± -->
      </div>
    </div>

    <div class="shop-section" id="character-shop">
      <h3>ìºë¦­í„°</h3>
      <div class="shop-items" id="character-items">
        <!-- ìºë¦­í„° ì•„ì´í…œ ë™ì  ìƒì„± -->
      </div>
    </div>

    <button id="close-shop" type="button">ë‹«ê¸°</button>
  </div>

  <script>
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const gameOverText = document.getElementById("game-over");
    const timerDisplay = document.getElementById("timer");
    const strawberryCount = document.getElementById("strawberry-num");
    const shopButton = document.getElementById("shop-button");
    const shopModal = document.getElementById("shop-modal");
    const closeShopBtn = document.getElementById("close-shop");

    const iconItemsData = [
      {icon: "ğŸ“", name: "ê¸°ë³¸", price: 0},
      {icon: "ğŸœ", name: "ğŸœ", price: 30},
      {icon: "ğŸ¦", name: "ğŸ¦", price: 50},
      {icon: "ğŸ­", name: "ğŸ­", price: 100},
    ];

    const characterItemsData = [
      {icon: "ğŸ‘©ğŸ»â€ğŸ³", name: "ê¸°ë³¸", price: 0},
      {icon: "ğŸ‘¨ğŸ»â€ğŸ³", name: "ğŸ‘¨ğŸ»â€ğŸ³", price: 0},
      {icon: "ğŸ‘©ğŸ»â€ğŸ”¬", name: "ğŸ‘©ğŸ»â€ğŸ”¬", price: 30},
      {icon: "ğŸ‘¨ğŸ»â€ğŸ”¬", name: "ğŸ‘¨ğŸ»â€ğŸ”¬", price: 30},
      {icon: "ğŸ‘®ğŸ»â€â™€ï¸", name: "ğŸ‘®ğŸ»â€â™€ï¸", price: 50},
      {icon: "ğŸ‘®ğŸ»â€â™‚ï¸", name: "ğŸ‘®ğŸ»â€â™‚ï¸", price: 50},
      {icon: "ğŸ‘©ğŸ»â€ğŸ“", name: "ğŸ‘©ğŸ»â€ğŸ“", price: 100},
      {icon: "ğŸ‘¨ğŸ»â€ğŸ“", name: "ğŸ‘¨ğŸ»â€ğŸ“", price: 100},
    ];

    let startTime = Date.now();
    let gameRunning = true;
    let invincible = false;
    let fallSpeed = 4;
    let objectInterval;
    let timerInterval;

    // í”Œë ˆì´ì–´ ì„ íƒ ì•„ì´í…œ ì €ì¥ ë° ë¡œë“œ
    let playerIcon = localStorage.getItem("playerIcon") || "ğŸ“";
    let playerCharacter = localStorage.getItem("playerCharacter") || "ğŸ‘©ğŸ»â€ğŸ³";

    // ë”¸ê¸° ê°œìˆ˜ ì €ì¥ ë° ë¡œë“œ
    let strawberry = parseInt(localStorage.getItem("strawberry")) || 0;

    // í˜„ì¬ ì‹œê°„ ê¸°ì¤€ ë”¸ê¸° ì§€ê¸‰ ì²´í¬ìš©
    let lastRewardTime = 0;

    function updateTimer() {
      if (!gameRunning) return;
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
      const seconds = String(elapsed % 60).padStart(2, '0');
      timerDisplay.textContent = `${minutes}:${seconds}`;

      // 45ì´ˆë§ˆë‹¤ ë”¸ê¸° 10ê°œ ì§€ê¸‰
      if (elapsed > 0 && elapsed % 45 === 0 && elapsed !== lastRewardTime) {
        strawberry += 10;
        saveStrawberry();
        lastRewardTime = elapsed;
        updateStrawberryCount();
      }
      return elapsed;
    }

    function updateStrawberryCount() {
      strawberryCount.textContent = strawberry;
      localStorage.setItem("strawberry", strawberry);
    }

    function moveCharacter(x, y) {
      player.style.left = `${x - player.offsetWidth / 2}px`;
      player.style.top = `${y - player.offsetHeight / 2}px`;
    }

    document.addEventListener("mousemove", (e) => {
      if (gameRunning) moveCharacter(e.clientX, e.clientY);
    });

    document.addEventListener("touchmove", (e) => {
      if (gameRunning) {
        const touch = e.touches[0];
        moveCharacter(touch.clientX, touch.clientY);
      }
    });

    function createObject() {
      const obj = document.createElement("div");
      obj.className = "falling";

      // ì•„ì´ì½˜ ì„ íƒ ë°˜ì˜ (ğŸ“ or ì„ íƒëœ ì•„ì´ì½˜)
      const isWatermelon = Math.random() < (Math.random() * 0.05 + 0.05); // 5~10%
      obj.textContent = isWatermelon ? "ğŸ‰" : playerIcon; // ê¸°ë³¸ ë”¸ê¸° ëŒ€ì‹  ì„ íƒëœ ì•„ì´ì½˜ ì‚¬ìš©
      obj.style.left = `${Math.random() * window.innerWidth}px`;
      obj.style.animationDuration = `${6 - Math.min(5, fallSpeed)}s`;

      game.appendChild(obj);

      const fallCheck = setInterval(() => {
        if (!gameRunning) return clearInterval(fallCheck);

        const objRect = obj.getBoundingClientRect();
        const playerRect = player.getBoundingClientRect();

        const hit =
          objRect.left < playerRect.right &&
          objRect.right > playerRect.left &&
          objRect.top < playerRect.bottom &&
          objRect.bottom > playerRect.top;

        if (hit) {
          if (obj.textContent === "ğŸ‰") {
            invincible = true;
            obj.remove();
            setTimeout(() => (invincible = false), 5000);
          } else if (!invincible) {
            endGame();
          }
        }

        if (objRect.top > window.innerHeight) {
          obj.remove();
          clearInterval(fallCheck);
        }
      }, 30);
    }

    function endGame() {
      gameRunning = false;
      clearInterval(objectInterval);
      clearInterval(timerInterval);
      const finalTime = updateTimer();
      gameOverText.innerHTML = `ê²Œì„ ì˜¤ë²„!<br>ìƒì¡´ ì‹œê°„: ${finalTime}ì´ˆ<br><br>ë”¸ê¸°: ${strawberry}ê°œ`;
      gameOverText.style.display = "block";
    }

    function startGame() {
      moveCharacter(window.innerWidth / 2, window.innerHeight - 100);
      startTime = Date.now();
      lastRewardTime = 0;
      gameRunning = true;
      gameOverText.style.display = "none";
      invincible = false;
      fallSpeed = 4;
      updateStrawberryCount();

      // í”Œë ˆì´ì–´ ìºë¦­í„° í‘œì‹œ ê°±ì‹ 
      player.textContent = playerCharacter;

      objectInterval = setInterval(() => {
        createObject();
        fallSpeed += 0.02;
      }, 800);

      timerInterval = setInterval(updateTimer, 1000);
    }

    function saveStrawberry() {
      localStorage.setItem("strawberry", strawberry);
    }
    function savePlayerIcon(icon) {
      localStorage.setItem("playerIcon", icon);
    }
    function savePlayerCharacter(char) {
      localStorage.setItem("playerCharacter", char);
    }

    // ìƒì  ì•„ì´í…œ ë™ì  ìƒì„±
    const iconItemsContainer = document.getElementById("icon-items");
    const characterItemsContainer = document.getElementById("character-items");

    function createShopItem(item, type, container) {
      const div = document.createElement("div");
      div.className = "shop-item";
      div.textContent = item.icon;
      div.title = item.name;
      if (item.price > 0) {
        const priceSpan = document.createElement("span");
        priceSpan.className = "price";
        priceSpan.textContent = `${item.price}ê°œ`;
        div.appendChild(priceSpan);
      } else {
        const priceSpan = document.createElement("span");
        priceSpan.className = "price";
        priceSpan.textContent = "ë¬´ë£Œ";
        div.appendChild(priceSpan);
      }

      // í˜„ì¬ ì„ íƒ í‘œì‹œ
      if (type === "icon" && item.icon === playerIcon) {
        div.classList.add("selected");
      } else if (type === "character" && item.icon === playerCharacter) {
        div.classList.add("selected");
      }

      // êµ¬ë§¤ ê°€ëŠ¥ ì—¬ë¶€ í‘œì‹œ
      if (item.price > strawberry) {
        div.classList.add("disabled");
      }

      div.addEventListener("click", () => {
        if (div.classList.contains("disabled")) return; // êµ¬ë§¤ ë¶ˆê°€

        if (type === "icon") {
          if (item.icon === playerIcon) return; // ì´ë¯¸ ì„ íƒë¨
          if (item.price > 0) {
            if (confirm(`${item.price} ë”¸ê¸°ë¥¼ ì‚¬ìš©í•´ ì•„ì´ì½˜ì„ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
              strawberry -= item.price;
              saveStrawberry();
              updateStrawberryCount();
              playerIcon = item.icon;
              savePlayerIcon(playerIcon);
              updateShopSelection(type, playerIcon);
            }
          } else {
            // ë¬´ë£Œ ì•„ì´í…œ ë°”ë¡œ ì„ íƒ
            playerIcon = item.icon;
            savePlayerIcon(playerIcon);
            updateShopSelection(type, playerIcon);
          }
        } else if (type === "character") {
          if (item.icon === playerCharacter) return; // ì´ë¯¸ ì„ íƒë¨
          if (item.price > 0) {
            if (confirm(`${item.price} ë”¸ê¸°ë¥¼ ì‚¬ìš©í•´ ìºë¦­í„°ë¥¼ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
              strawberry -= item.price;
              saveStrawberry();
              updateStrawberryCount();
              playerCharacter = item.icon;
              savePlayerCharacter(playerCharacter);
              updateShopSelection(type, playerCharacter);
              player.textContent = playerCharacter; // ì¦‰ì‹œ ë°˜ì˜
            }
          } else {
            // ë¬´ë£Œ ì•„ì´í…œ ë°”ë¡œ ì„ íƒ
            playerCharacter = item.icon;
            savePlayerCharacter(playerCharacter);
            updateShopSelection(type, playerCharacter);
            player.textContent = playerCharacter; // ì¦‰ì‹œ ë°˜ì˜
          }
        }
      });

      container.appendChild(div);
    }

    function updateShopSelection(type, selectedIcon) {
      let container;
      if (type === "icon") container = iconItemsContainer;
      else container = characterItemsContainer;

      [...container.children].forEach(div => {
        div.classList.remove("selected");
        div.classList.remove("disabled");

        const icon = div.firstChild.textContent; // ì´ëª¨ì§€ í…ìŠ¤íŠ¸

        // ê°€ê²© ì²´í¬í•´ì„œ disabled ì„¤ì •
        const itemData = (type === "icon" ? iconItemsData : characterItemsData)
          .find(item => item.icon === icon);

        if (!itemData) return;

        if (icon === selectedIcon) {
          div.classList.add("selected");
        }

        if (itemData.price > strawberry) {
          div.classList.add("disabled");
        }
      });
    }

    // ìƒì  ì•„ì´í…œ ì´ˆê¸° ìƒì„±
    function initShop() {
      iconItemsContainer.innerHTML = "";
      characterItemsContainer.innerHTML = "";

      iconItemsData.forEach(item => createShopItem(item, "icon", iconItemsContainer));
      characterItemsData.forEach(item => createShopItem(item, "character", characterItemsContainer));
    }

    shopButton.addEventListener("click", () => {
      if (gameRunning) {
        // ê²Œì„ ì¤‘ ì¼ì‹œì •ì§€ ê¸°ëŠ¥ ì¶”ê°€ ê°€ëŠ¥ (ì„ íƒ ì‚¬í•­)
      }
      initShop();
      updateShopSelection("icon", playerIcon);
      updateShopSelection("character", playerCharacter);
      shopModal.style.display = "block";
    });

    closeShopBtn.addEventListener("click", () => {
      shopModal.style.display = "none";
    });

    // ê²Œì„ ì‹œì‘
    updateStrawberryCount();
    player.textContent = playerCharacter;
    startGame();

  </script>
</body>
</html>
