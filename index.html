<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë”¸ê¸°ë¥¼ í”¼í•´ë¼!</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #ffe0f0;
      font-family: "Arial", sans-serif;
    }

    #game {
      position: relative;
      width: 100vw;
      height: 100vh;
    }

    .character {
      position: absolute;
      font-size: 40px;
      pointer-events: none;
      transition: transform 0.05s linear;
    }

    .falling {
      position: absolute;
      font-size: 32px;
      animation-name: fall;
      animation-timing-function: linear;
      animation-fill-mode: forwards;
    }

    @keyframes fall {
      from {
        top: -50px;
      }
      to {
        top: 100vh;
      }
    }

    #timer {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 18px;
      background: #fff0f7;
      padding: 6px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      user-select: none;
      z-index: 1000;
    }

    #game-over {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 28px;
      color: #ff4d88;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      display: none;
      text-align: center;
      z-index: 1000;
    }

    /* ìƒì  ë²„íŠ¼ */
    #shop-button {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
      padding: 6px 12px;
      background: #ff99bb;
      border: none;
      border-radius: 12px;
      color: white;
      cursor: pointer;
      z-index: 1000;
    }

    /* ìƒì  ëª¨ë‹¬ */
    #shop-modal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      width: 320px;
      max-width: 90vw;
      max-height: 80vh;
      overflow-y: auto;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      padding: 20px;
      z-index: 2000;
    }

    #shop-modal h2 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #ff4d88;
      text-align: center;
    }

    .item-list {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
    }

    .item {
      width: 60px;
      height: 60px;
      border: 2px solid #ff99bb;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s;
    }
    .item:hover {
      background-color: #ffe0f0;
    }
    .item.selected {
      border-color: #ff4d88;
      background-color: #ffd1df;
    }
    .item .icon {
      font-size: 30px;
    }
    .item .cost {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }

    #close-shop {
      display: block;
      margin: 15px auto 0;
      background: #ff4d88;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 8px 20px;
      font-size: 16px;
      cursor: pointer;
    }

    #strawberry-count {
      position: absolute;
      top: 50px;
      left: 10px;
      font-size: 18px;
      background: #fff0f7;
      padding: 6px 12px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      user-select: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="timer">00:00</div>
    <div id="strawberry-count">ğŸ“: 0</div>
    <button id="shop-button">ìƒì </button>
    <div id="player" class="character">ğŸ‘©ğŸ»â€ğŸ³</div>
    <div id="game-over"></div>
  </div>

  <div id="shop-modal">
    <h2>ìƒì </h2>

    <div>
      <h3>ì•„ì´ì½˜</h3>
      <div id="icon-items" class="item-list"></div>
    </div>

    <div style="margin-top: 20px;">
      <h3>ìºë¦­í„°</h3>
      <div id="character-items" class="item-list"></div>
    </div>

    <button id="close-shop">ë‹«ê¸°</button>
  </div>

  <script>
    const game = document.getElementById("game");
    const player = document.getElementById("player");
    const gameOverText = document.getElementById("game-over");
    const timerDisplay = document.getElementById("timer");
    const strawberryCountDisplay = document.getElementById("strawberry-count");
    const shopButton = document.getElementById("shop-button");
    const shopModal = document.getElementById("shop-modal");
    const closeShopButton = document.getElementById("close-shop");
    const iconItemsContainer = document.getElementById("icon-items");
    const characterItemsContainer = document.getElementById("character-items");

    let startTime = Date.now();
    let gameRunning = true;
    let invincible = false;
    let fallSpeed = 4; // ì´ˆê¸° ì†ë„ ìœ ì§€
    let objectInterval;
    let timerInterval;
    let paused = false;
    let strawberries = 0;
    let selectedIcon = "ğŸ“";
    let selectedCharacter = "ğŸ‘©ğŸ»â€ğŸ³";

    // ì•„ì´í…œ ëª©ë¡ ë°ì´í„°
    const iconItems = [
      { icon: "ğŸ“", cost: 0 },
      { icon: "ğŸœ", cost: 30 },
      { icon: "ğŸ¦", cost: 50 },
      { icon: "ğŸ­", cost: 100 },
    ];

    const characterItems = [
      { icon: "ğŸ‘©ğŸ»â€ğŸ³", cost: 0 },
      { icon: "ğŸ‘¨ğŸ»â€ğŸ³", cost: 0 },
      { icon: "ğŸ‘©ğŸ»â€ğŸ”¬", cost: 30 },
      { icon: "ğŸ‘¨ğŸ»â€ğŸ”¬", cost: 30 },
      { icon: "ğŸ‘®ğŸ»â€â™€ï¸", cost: 50 },
      { icon: "ğŸ‘®ğŸ»â€â™‚ï¸", cost: 50 },
      { icon: "ğŸ‘©ğŸ»â€ğŸ“", cost: 100 },
      { icon: "ğŸ‘¨ğŸ»â€ğŸ“", cost: 100 },
    ];

    // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
    function updateTimer() {
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
      const seconds = String(elapsed % 60).padStart(2, '0');
      timerDisplay.textContent = `${minutes}:${seconds}`;

      // ë”¸ê¸° ì§€ê¸‰ (45ì´ˆë§ˆë‹¤ 10ê°œ)
      if (elapsed > 0 && elapsed % 45 === 0 && !paused) {
        strawberries += 10;
        strawberryCountDisplay.textContent = `ğŸ“: ${strawberries}`;
        // ì ì‹œ ì¤‘ë³µ ì§€ê¸‰ ë°©ì§€ ìœ„í•´ ì ê¹ pause ì²˜ë¦¬
        paused = true;
        setTimeout(() => { paused = false; }, 1000);
      }

      return elapsed;
    }

    // ìºë¦­í„° ì´ë™ (xì¶•, yì¶• ì œí•œ)
    function moveCharacter(x, y) {
      const boundedX = Math.min(Math.max(x, 0), window.innerWidth);
      const boundedY = Math.min(Math.max(y, 0), window.innerHeight);
      player.style.left = `${boundedX - player.offsetWidth / 2}px`;
      player.style.top = `${boundedY - player.offsetHeight / 2}px`;
    }

    document.addEventListener("mousemove", (e) => {
      if (gameRunning) moveCharacter(e.clientX, e.clientY);
    });

    document.addEventListener("touchmove", (e) => {
      if (gameRunning && e.touches.length > 0) {
        moveCharacter(e.touches[0].clientX, e.touches[0].clientY);
      }
    }, { passive: false });

    // ê²Œì„ ì¢…ë£Œ í•¨ìˆ˜
    function endGame() {
      gameRunning = false;
      paused = false;
      clearInterval(objectInterval);
      clearInterval(timerInterval);
      const finalTime = Math.floor((Date.now() - startTime) / 1000);
      gameOverText.innerHTML = `ê²Œì„ ì˜¤ë²„!<br>ìƒì¡´ ì‹œê°„: ${finalTime}ì´ˆ<br>íšë“ ë”¸ê¸°: ${strawberries}ê°œ`;
      gameOverText.style.display = "block";
    }

    // ë–¨ì–´ì§€ëŠ” ê°ì²´ ìƒì„±
    function createObject() {
      if (!gameRunning) return;

      const obj = document.createElement("div");
      obj.className = "falling";

      const isWatermelon = Math.random() < (Math.random() * 0.05 + 0.05);
      obj.textContent = isWatermelon ? "ğŸ‰" : selectedIcon;

      obj.style.left = `${Math.random() * (window.innerWidth - 30)}px`;
      // ì• ë‹ˆë©”ì´ì…˜ ì§€ì†ì‹œê°„ = 6 - fallSpeed (ìµœì†Œ 1ì´ˆ ë³´ì¥)
      const duration = Math.max(1, 6 - Math.min(5, fallSpeed));
      obj.style.animationDuration = `${duration}s`;

      game.appendChild(obj);

      const fallCheck = setInterval(() => {
        if (!gameRunning) {
          clearInterval(fallCheck);
          return;
        }

        const objRect = obj.getBoundingClientRect();
        const playerRect = player.getBoundingClientRect();

        // ì¶©ëŒ ì²´í¬ (x,yì¶•ë§Œ)
        const hit =
          objRect.left < playerRect.right &&
          objRect.right > playerRect.left &&
          objRect.top < playerRect.bottom &&
          objRect.bottom > playerRect.top;

        if (hit) {
          if (obj.textContent === "ğŸ‰") {
            invincible = true;
            obj.remove();
            setTimeout(() => (invincible = false), 5000);
          } else if (!invincible) {
            endGame();
          }
          clearInterval(fallCheck);
        }

        // í™”ë©´ ì•„ë˜ë¡œ ë‚´ë ¤ê°€ë©´ ì œê±°
        if (objRect.top > window.innerHeight) {
          obj.remove();
          clearInterval(fallCheck);
          if (obj.textContent === selectedIcon) {
            // ë”¸ê¸° ë†“ì¹¨ í˜ë„í‹° ì—†ìŒ
          }
        }
      }, 30);
    }

    // ê²Œì„ ì‹œì‘ ì´ˆê¸°í™” ë° ë°˜ë³µ ê°ì²´ ìƒì„±
    function startGame() {
      startTime = Date.now();
      gameRunning = true;
      invincible = false;
      strawberries = 0;
      fallSpeed = 4;
      strawberryCountDisplay.textContent = `ğŸ“: 0`;
      gameOverText.style.display = "none";

      objectInterval = setInterval(() => {
        createObject();
        fallSpeed += 0.02;  // ì†ë„ ì ì§„ ì¦ê°€ (ì¡°ì ˆ ê°€ëŠ¥)
      }, 1200);

      timerInterval = setInterval(updateTimer, 1000);
    }

    // ìƒì  ì•„ì´í…œ ë Œë”ë§
    function renderShopItems() {
      // ì•„ì´ì½˜ ì•„ì´í…œ ë Œë”ë§
      iconItemsContainer.innerHTML = "";
      iconItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "item";
        if (selectedIcon === item.icon) div.classList.add("selected");
        div.innerHTML = `<div class="icon">${item.icon}</div><div class="cost">${item.cost} ğŸ“</div>`;
        div.addEventListener("click", () => {
          if (item.cost <= strawberries) {
            strawberries -= item.cost;
            selectedIcon = item.icon;
            strawberryCountDisplay.textContent = `ğŸ“: ${strawberries}`;
            renderShopItems();
          } else {
            alert("ë”¸ê¸°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
          }
        });
        iconItemsContainer.appendChild(div);
      });

      // ìºë¦­í„° ì•„ì´í…œ ë Œë”ë§
      characterItemsContainer.innerHTML = "";
      characterItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "item";
        if (selectedCharacter === item.icon) div.classList.add("selected");
        div.innerHTML = `<div class="icon">${item.icon}</div><div class="cost">${item.cost} ğŸ“</div>`;
        div.addEventListener("click", () => {
          if (item.cost <= strawberries) {
            strawberries -= item.cost;
            selectedCharacter = item.icon;
            player.textContent = selectedCharacter;
            strawberryCountDisplay.textContent = `ğŸ“: ${strawberries}`;
            renderShopItems();
          } else {
            alert("ë”¸ê¸°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!");
          }
        });
        characterItemsContainer.appendChild(div);
      });
    }

    // ìƒì  ì—´ê¸°/ë‹«ê¸°
    shopButton.addEventListener("click", () => {
      if (!gameRunning) return;
      shopModal.style.display = "block";
      paused = true;
      clearInterval(objectInterval);
      clearInterval(timerInterval);
      renderShopItems();
    });

    closeShopButton.addEventListener("click", () => {
      shopModal.style.display = "none";
      paused = false;
      // ë‹¤ì‹œ ê²Œì„ ì¬ê°œ
      objectInterval = setInterval(() => {
        createObject();
        fallSpeed += 0.02;
      }, 1200);

      timerInterval = setInterval(updateTimer, 1000);
    });

    // ì´ˆê¸° ìºë¦­í„° ìœ„ì¹˜ ì¤‘ì•™
    moveCharacter(window.innerWidth / 2, window.innerHeight / 2);

    // ê²Œì„ ì‹œì‘
    startGame();
  </script>
</body>
</html>
