<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¥˜ë¼ì´ íŒ¬ì‚¬ì´íŠ¸</title>
<style>
  /* ê¸°ë³¸ ìŠ¤íƒ€ì¼, í•˜ë‹¨ íƒ­ ìŠ¤íƒ€ì¼ */
  body, html {
    margin: 0; padding: 0; font-family: "Noto Sans KR", sans-serif;
    background: #fff0f6; color: #333;
  }
  #app {
    min-height: 100vh;
    display: flex; flex-direction: column;
  }
  header {
    background: #f8bbd0; padding: 12px; text-align: center; font-weight: 700; font-size: 1.5rem;
  }
  main {
    flex: 1; padding: 10px; overflow-y: auto;
  }
  nav {
    height: 56px;
    display: flex;
    background: #f48fb1;
    border-top: 1px solid #ccc;
  }
  nav button {
    flex: 1;
    border: none;
    background: transparent;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    cursor: pointer;
    outline: none;
    transition: background 0.3s;
  }
  nav button.active,
  nav button:hover {
    background: #ec407a;
  }
  input, textarea, select {
    width: 100%;
    padding: 8px;
    margin: 6px 0;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
  }
  button.primary {
    background: #ec407a;
    border: none;
    color: white;
    padding: 10px;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
  }
  button.primary:disabled {
    background: #f8bbd0;
    cursor: not-allowed;
  }
  .hidden {
    display: none !important;
  }
  .letter {
    background: #fff0f6;
    border: 1px solid #f48fb1;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 8px;
  }
  .letter .actions {
    margin-top: 6px;
  }
  .letter .actions button {
    margin-right: 6px;
  }
  /* ê¸°íƒ€ í•„ìš”í•œ ìŠ¤íƒ€ì¼ì€ ì—¬ê¸°ì— */
</style>
</head>
<body>
<div id="app">
  <header>ë¥˜ë¼ì´ íŒ¬ì‚¬ì´íŠ¸</header>
  <main id="main-content">
    <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì…/ë©”ì¸ í™”ë©´ì´ ì—¬ê¸° ë‚˜íƒ€ë‚©ë‹ˆë‹¤ -->
  </main>
  <nav id="tab-bar" class="hidden">
    <button data-tab="profile" class="active">ğŸŒ¸ í”„ë¡œí•„</button>
    <button data-tab="home">ğŸ  í™ˆ</button>
    <button data-tab="fan">ğŸ’Œ íŒ¬</button>
    <button data-tab="suggestion">ğŸ›  ê±´ì˜</button>
    <button data-tab="shop">ğŸ› ìƒì </button>
  </nav>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
  // === Firebase ì´ˆê¸°í™” ===
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // === ì „ì—­ ìƒíƒœ ===
  let currentUser = null;
  let currentUserData = null; // íŒŒì´ì–´ìŠ¤í† ì–´ users ë¬¸ì„œ (role í¬í•¨)
  let currentTab = "profile";

  // === DOM ì°¸ì¡° ===
  const app = document.getElementById("app");
  const mainContent = document.getElementById("main-content");
  const tabBar = document.getElementById("tab-bar");

  // === ìœ í‹¸ í•¨ìˆ˜ ===
  function setLoading(msg = "ë¡œë”© ì¤‘...") {
    mainContent.innerHTML = `<p>${msg}</p>`;
  }
  function formatDate(ts) {
    if (!ts) return "-";
    const d = ts.toDate ? ts.toDate() : new Date(ts);
    return d.toLocaleString();
  }
  function daysUntilSep16() {
    const now = new Date();
    let year = now.getFullYear();
    const sept16 = new Date(year, 8, 16); // 8=9ì›” (0ë¶€í„° ì‹œì‘)
    if (now > sept16) year++;
    const target = new Date(year, 8, 16);
    const diff = Math.ceil((target - now) / (1000 * 60 * 60 * 24));
    return diff;
  }
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!"));
  }

  // === ë¡œê·¸ì¸/íšŒì›ê°€ì… UI ===
  function renderLogin() {
    tabBar.classList.add("hidden");
    mainContent.innerHTML = `
      <h2>ë¡œê·¸ì¸</h2>
      <input type="email" id="login-email" placeholder="ì´ë©”ì¼" />
      <input type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
      <button id="login-btn" class="primary">ë¡œê·¸ì¸</button>
      <p>ê³„ì •ì´ ì—†ë‚˜ìš”? <a href="#" id="to-signup">íšŒì›ê°€ì…</a></p>
    `;

    document.getElementById("login-btn").onclick = async () => {
      const email = document.getElementById("login-email").value.trim();
      const password = document.getElementById("login-password").value;
      if (!email || !password) {
        alert("ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      setLoading("ë¡œê·¸ì¸ ì¤‘...");
      try {
        await auth.signInWithEmailAndPassword(email, password);
      } catch (e) {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message);
        renderLogin();
      }
    };
    document.getElementById("to-signup").onclick = (e) => {
      e.preventDefault();
      renderSignUp();
    };
  }

  function renderSignUp() {
    tabBar.classList.add("hidden");
    mainContent.innerHTML = `
      <h2>íšŒì›ê°€ì…</h2>
      <input type="email" id="signup-email" placeholder="ì´ë©”ì¼" />
      <input type="password" id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
      <input type="password" id="signup-password-confirm" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
      <button id="signup-btn" class="primary">íšŒì›ê°€ì…</button>
      <p>ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? <a href="#" id="to-login">ë¡œê·¸ì¸</a></p>
    `;

    document.getElementById("signup-btn").onclick = async () => {
      const email = document.getElementById("signup-email").value.trim();
      const password = document.getElementById("signup-password").value;
      const passwordConfirm = document.getElementById("signup-password-confirm").value;
      if (!email || !password || !passwordConfirm) {
        alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      if (password !== passwordConfirm) {
        alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }
      setLoading("íšŒì›ê°€ì… ì¤‘...");
      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        // ê°€ì… ì‹œì ì— roleì€ "member"ë¡œ ê¸°ë³¸ ì„¤ì •
        await db.collection("users").doc(userCredential.user.uid).set({
          email: email,
          role: "member",
          nickname: "",
          intro: "",
          profileImageUrl: "",
          lastVisit: firebase.firestore.FieldValue.serverTimestamp(),
          strawberryPoints: 0,
        });
      } catch (e) {
        alert("íšŒì›ê°€ì… ì‹¤íŒ¨: " + e.message);
        renderSignUp();
      }
    };
    document.getElementById("to-login").onclick = (e) => {
      e.preventDefault();
      renderLogin();
    };
  }

  // === ë©”ì¸ í˜ì´ì§€ UI ===
  function renderMain() {
    tabBar.classList.remove("hidden");
    renderTab(currentTab);
  }

  // === íƒ­ ë Œë”ë§ í•¨ìˆ˜ ===
  async function renderTab(tabName) {
    currentTab = tabName;
    // íƒ­ ë²„íŠ¼ í™œì„±í™” í‘œì‹œ
    [...tabBar.children].forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.tab === tabName);
    });

    if (tabName === "profile") {
      await renderProfileTab();
    } else if (tabName === "home") {
      renderHomeTab();
    } else if (tabName === "fan") {
      await renderFanTab();
    } else if (tabName === "suggestion") {
      await renderSuggestionTab();
    } else if (tabName === "shop") {
      await renderShopTab();
    }
  }

  // === í”„ë¡œí•„ íƒ­ ===
  async function renderProfileTab() {
    // DBì—ì„œ ìµœì‹  user data ê°€ì ¸ì˜¤ê¸°
    const userDoc = await db.collection("users").doc(currentUser.uid).get();
    currentUserData = userDoc.data();

    mainContent.innerHTML = `
      <h2>ğŸŒ¸ í”„ë¡œí•„ ê¾¸ë¯¸ê¸°</h2>
      <img id="profile-img-preview" src="${currentUserData.profileImageUrl || 'https://via.placeholder.com/120'}" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" width="120" height="120" style="border-radius:50%; object-fit:cover;" />
      <input type="file" id="profile-img-upload" accept="image/*" />
      <label>ë‹‰ë„¤ì„</label>
      <input type="text" id="profile-nickname" value="${currentUserData.nickname || ''}" maxlength="20" />
      <label>ì†Œê°œê¸€</label>
      <textarea id="profile-intro" rows="3" maxlength="100">${currentUserData.intro || ''}</textarea>
      <button id="save-profile-btn" class="primary">ì €ì¥í•˜ê¸°</button>

      <hr />
      <h3>ğŸ“¨ í¸ì§€ ê´€ë¦¬</h3>
      <div id="letters-list">ë¡œë”© ì¤‘...</div>

      <hr />
      <h3>í”„ë¡œí•„ ê³µìœ </h3>
      <button id="copy-link-btn">í”„ë¡œí•„ ë§í¬ ë³µì‚¬</button>
      <div id="qrcode-container" style="margin-top:10px;"></div>

      <hr />
      <button id="logout-btn" style="background:#f44336; color:#fff; border:none; padding:10px; border-radius:6px;">ë¡œê·¸ì•„ì›ƒ</button>
    `;

    // í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
    const profileImgInput = document.getElementById("profile-img-upload");
    profileImgInput.onchange = async (e) => {
      const file = e.target.files[0];
      if (!file) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      // Firebase Storage ì—…ë¡œë“œë¥¼ ì—¬ê¸°ì— êµ¬í˜„ ê°€ëŠ¥ (ìƒëµ: ì‹¤ì œ ì„œë¹„ìŠ¤ìš©)
      alert("í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.");
    };

    // ì €ì¥ ë²„íŠ¼
    document.getElementById("save-profile-btn").onclick = async () => {
      const newNickname = document.getElementById("profile-nickname").value.trim();
      const newIntro = document.getElementById("profile-intro").value.trim();

      if (newNickname.length === 0) {
        alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }
      // ì—…ë°ì´íŠ¸
      await db.collection("users").doc(currentUser.uid).update({
        nickname: newNickname,
        intro: newIntro,
        lastVisit: firebase.firestore.FieldValue.serverTimestamp(),
      });
      alert("í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
      renderProfileTab();
    };

    // í¸ì§€ ë¶ˆëŸ¬ì˜¤ê¸° (ë³¸ì¸ í¸ì§€ + ê´€ë¦¬ì ê¶Œí•œì ì—´ëŒìš©)
    await renderLettersList();

    // í”„ë¡œí•„ ë§í¬ ë³µì‚¬ + QR ì½”ë“œ ìƒì„±
    document.getElementById("copy-link-btn").onclick = () => {
      const url = `${window.location.origin}/?uid=${currentUser.uid}`;
      copyToClipboard(url);
      renderQRCode(url);
    };

    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById("logout-btn").onclick = () => {
      auth.signOut();
    };
  }

  // í¸ì§€ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§
  async function renderLettersList() {
    const lettersDiv = document.getElementById("letters-list");
    lettersDiv.innerHTML = "í¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

    let queryRef = db.collection("letters").where("receiverUid", "==", currentUser.uid).orderBy("sentAt", "desc");

    // ê´€ë¦¬ì ì´ìƒì´ë©´ ëª¨ë“  í¸ì§€ ì¡°íšŒ ê°€ëŠ¥ (ë³¸ì¸ í¬í•¨)
    if (currentUserData.role === "admin" || currentUserData.role === "manager") {
      queryRef = db.collection("letters").orderBy("sentAt", "desc");
    }

    const snapshot = await queryRef.get();
    if (snapshot.empty) {
      lettersDiv.innerHTML = "<p>í¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    const lettersHtml = snapshot.docs.map(doc => {
      const data = doc.data();
      const from = data.senderNickname || "ìµëª…";
      const content = data.content || "";
      const dateStr = formatDate(data.sentAt);
      return `
        <div class="letter" data-id="${doc.id}">
          <b>ë³´ë‚¸ ì‚¬ëŒ:</b> ${from}<br/>
          <b>ë‚´ìš©:</b> ${content.replace(/\n/g, "<br>")}<br/>
          <small>ë‚ ì§œ: ${dateStr}</small>
          ${currentUserData.role === "admin" || currentUserData.role === "manager" ? `
            <div class="actions">
              <button onclick="deleteLetter('${doc.id}')">ì‚­ì œ</button>
            </div>
          ` : ""}
        </div>
      `;
    }).join("");
    lettersDiv.innerHTML = lettersHtml;
  }

  // í¸ì§€ ì‚­ì œ (ê´€ë¦¬ì ì „ìš©)
  window.deleteLetter = async (id) => {
    if (!confirm("ì •ë§ í¸ì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    await db.collection("letters").doc(id).delete();
    alert("í¸ì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
    renderLettersList();
  };

  // === í™ˆ íƒ­ ===
  function renderHomeTab() {
    const dday = daysUntilSep16();
    mainContent.innerHTML = `
      <h2>ğŸ  í™ˆ</h2>
      <p>ë‹¤ìŒ í˜ìŠ¤í‹°ë²Œê¹Œì§€ <strong>${dday}ì¼</strong> ë‚¨ì•˜ìŠµë‹ˆë‹¤!</p>
      <hr />
      <h3>ê³µì§€ì‚¬í•­</h3>
      <p>ë¥˜ë¼ì´ì˜ ìµœì‹  ì†Œì‹ê³¼ ê³µì§€ëŠ” ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
    `;
  }

  // === íŒ¬ íƒ­ ===
  async function renderFanTab() {
    mainContent.innerHTML = `
      <h2>ğŸ’Œ íŒ¬ í™œë™</h2>
      <h3>í¸ì§€ ë³´ë‚´ê¸°</h3>
      <textarea id="fan-letter-input" rows="4" placeholder="ë¥˜ë¼ì´ì—ê²Œ í¸ì§€ë¥¼ ì¨ë³´ì„¸ìš”!"></textarea>
      <button id="send-letter-btn" class="primary">í¸ì§€ ë³´ë‚´ê¸°</button>
      <hr />
      <h3>ë‚˜ì˜ íŒ¬ í™œë™ ê¸°ë¡</h3>
      <div id="fan-letters-list">ë¡œë”© ì¤‘...</div>
    `;

    document.getElementById("send-letter-btn").onclick = async () => {
      const content = document.getElementById("fan-letter-input").value.trim();
      if (content.length === 0) {
        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      // í¸ì§€ ì €ì¥
      await db.collection("letters").add({
        senderUid: currentUser.uid,
        senderNickname: currentUserData.nickname || "ë¬´ëª…",
        receiverUid: "ë¥˜ë¼ì´_UID", // ë¥˜ë¼ì´ì˜ UID (ê´€ë¦¬ì ê³„ì • UIDë¡œ ëŒ€ì²´)
        content,
        sentAt: firebase.firestore.FieldValue.serverTimestamp(),
      });
      alert("í¸ì§€ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
      document.getElementById("fan-letter-input").value = "";
      renderFanLettersList();
    };

    await renderFanLettersList();
  }

  // íŒ¬ì´ ë³´ë‚¸ í¸ì§€ ê¸°ë¡ ë³´ì—¬ì£¼ê¸° (ë³¸ì¸ì´ ë³´ë‚¸ í¸ì§€ë“¤)
  async function renderFanLettersList() {
    const fanLettersDiv = document.getElementById("fan-letters-list");
    fanLettersDiv.innerHTML = "ë¡œë”© ì¤‘...";

    const snapshot = await db.collection("letters")
      .where("senderUid", "==", currentUser.uid)
      .orderBy("sentAt", "desc")
      .get();

    if (snapshot.empty) {
      fanLettersDiv.innerHTML = "<p>ë³´ë‚¸ í¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }

    const lettersHtml = snapshot.docs.map(doc => {
      const data = doc.data();
      const content = data.content || "";
      const dateStr = formatDate(data.sentAt);
      return `
        <div class="letter" data-id="${doc.id}">
          <b>ë°›ëŠ” ì‚¬ëŒ:</b> ë¥˜ë¼ì´<br/>
          <b>ë‚´ìš©:</b> ${content.replace(/\n/g, "<br>")}<br/>
          <small>ë‚ ì§œ: ${dateStr}</small>
        </div>
      `;
    }).join("");
    fanLettersDiv.innerHTML = lettersHtml;
  }

  // === ê±´ì˜ íƒ­ ===
  async function renderSuggestionTab() {
    mainContent.innerHTML = `
      <h2>ğŸ›  ê±´ì˜ ë° ì‹ ê³ </h2>
      <textarea id="suggestion-input" rows="4" placeholder="ê±´ì˜ì‚¬í•­ì´ë‚˜ ì‹ ê³  ë‚´ìš©ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
      <button id="send-suggestion-btn" class="primary">ì „ì†¡í•˜ê¸°</button>
      <hr />
      <h3>ë‚´ê°€ ë³´ë‚¸ ê±´ì˜/ì‹ ê³  ë‚´ì—­</h3>
      <div id="my-suggestions-list">ë¡œë”© ì¤‘...</div>
    `;

    document.getElementById("send-suggestion-btn").onclick = async () => {
      const content = document.getElementById("suggestion-input").value.trim();
      if (!content) {
        alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }
      await db.collection("suggestions").add({
        senderUid: currentUser.uid,
        senderNickname: currentUserData.nickname || "ë¬´ëª…",
        content,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        handled: false,
      });
      alert("ê±´ì˜/ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!");
      document.getElementById("suggestion-input").value = "";
      renderMySuggestionsList();
    };

    await renderMySuggestionsList();
  }

  async function renderMySuggestionsList() {
    const listDiv = document.getElementById("my-suggestions-list");
    const snapshot = await db.collection("suggestions")
      .where("senderUid", "==", currentUser.uid)
      .orderBy("createdAt", "desc")
      .get();
    if (snapshot.empty) {
      listDiv.innerHTML = "<p>ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
      return;
    }
    const html = snapshot.docs.map(doc => {
      const data = doc.data();
      return `<div class="letter">
        <p>${data.content.replace(/\n/g, "<br>")}</p>
        <small>${formatDate(data.createdAt)} - ì²˜ë¦¬ ìƒíƒœ: ${data.handled ? "ì²˜ë¦¬ë¨" : "ë¯¸ì²˜ë¦¬"}</small>
      </div>`;
    }).join("");
    listDiv.innerHTML = html;
  }

  // === ìƒì  íƒ­ ===
  async function renderShopTab() {
    mainContent.innerHTML = `
      <h2>ğŸ› ìƒì </h2>
      <p>ë¥˜ë¼ì´ êµ¿ì¦ˆë¥¼ ì†Œê°œí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>
      <ul>
        <li>êµ¿ì¦ˆ 1 - ê°€ê²©: 10,000ë”¸ê¸°í¬ì¸íŠ¸</li>
        <li>êµ¿ì¦ˆ 2 - ê°€ê²©: 15,000ë”¸ê¸°í¬ì¸íŠ¸</li>
        <li>í¬í† ì¹´ë“œ ì„¸íŠ¸ - ê°€ê²©: 5,000ë”¸ê¸°í¬ì¸íŠ¸ (í•œì • ìˆ˜ëŸ‰)</li>
      </ul>
      <p><em>ì•„ì´í…œ êµ¬ë§¤ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.</em></p>
      <p>í˜„ì¬ ë³´ìœ  ë”¸ê¸°í¬ì¸íŠ¸: <strong id="strawberry-points">0</strong> ë”¸ê¸°</p>
    `;

    const spElem = document.getElementById("strawberry-points");
    spElem.textContent = currentUserData.strawberryPoints || 0;
  }

  // === QR ì½”ë“œ ìƒì„± í•¨ìˆ˜ ===
  function renderQRCode(text) {
    const container = document.getElementById("qrcode-container");
    container.innerHTML = "";
    QRCode.toCanvas(text, { width: 128 }, (err, canvas) => {
      if (err) return;
      container.appendChild(canvas);
    });
  }

  // === ì‚¬ìš©ì ì •ë³´ ê°±ì‹  ===
  async function fetchCurrentUserData(uid) {
    const docSnap = await db.collection("users").doc(uid).get();
    if (!docSnap.exists) return null;
    return docSnap.data();
  }

  // === íƒ­ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì—°ê²° ===
  tabBar.onclick = (e) => {
    if (e.target.tagName === "BUTTON") {
      renderTab(e.target.dataset.tab);
    }
  };

  // === Firebase Auth ìƒíƒœ ë³€í™” ê°ì§€ ===
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      currentUser = user;
      currentUserData = await fetchCurrentUserData(user.uid);
      renderMain();
    } else {
      currentUser = null;
      currentUserData = null;
      renderLogin();
    }
  });

</script>
</body>
</html>
