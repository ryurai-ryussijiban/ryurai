<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¥˜ë¼ì´ íŒ¬ì‚¬ì´íŠ¸</title>
<style>
  /* ê¸°ë³¸ ìŠ¤íƒ€ì¼, ë ˆì´ì•„ì›ƒ */
  body, html { margin:0; padding:0; font-family: 'Noto Sans KR', sans-serif; background:#fff0f6; color:#333;}
  header { background:#f8bbd0; color:#fff; padding:15px; font-size:1.4rem; font-weight:bold; text-align:center; position:relative;}
  #notice { font-size:0.9rem; background:#f48fb1; color:#fff; padding:5px 10px; margin-top:5px; }
  main { padding:10px; min-height:calc(100vh - 130px);}
  nav { position:fixed; bottom:0; left:0; width:100%; background:#f8bbd0; display:flex; justify-content:space-around; border-top:2px solid #f06292; }
  nav button { background:none; border:none; padding:10px 0; flex:1; color:#fff; font-weight:600; font-size:1rem; cursor:pointer;}
  nav button.active { background:#f06292; }

  section { display:none; }
  section.active { display:block; }

  /* í”„ë¡œí•„ íƒ­ */
  #profile img#profile-img { width:120px; height:120px; border-radius:50%; object-fit:cover; border:3px solid #f06292; margin-bottom:10px; cursor:pointer;}
  #profile input[type="file"] { display:none; }
  #profile label#upload-label { display:inline-block; background:#f48fb1; color:#fff; padding:5px 12px; border-radius:8px; cursor:pointer; margin-bottom:10px; }
  #profile input, #profile textarea { width:100%; padding:8px; border:1px solid #f48fb1; border-radius:5px; margin-bottom:10px; font-size:1rem; }
  #profile textarea { resize:none; height:60px; }
  #profile button { background:#f06292; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; margin-right:10px;}
  #profile button.delete { background:#e57373; }
  #profile .letter { background:#fff; border:1px solid #f48fb1; border-radius:8px; padding:10px; margin-bottom:8px; }
  #profile .letter .actions { margin-top:5px; }
  #profile .letter .actions button { font-size:0.8rem; padding:3px 6px; margin-right:5px; border:none; border-radius:4px; cursor:pointer;}
  #profile .letter .actions button.edit { background:#f48fb1; color:#fff; }
  #profile .letter .actions button.delete { background:#e57373; color:#fff; }
  #profile .letter textarea { width:100%; height:50px; font-size:0.9rem; }

  /* í™ˆ íƒ­ */
  #home .sns-btns a { margin-right:10px; text-decoration:none; color:#fff; background:#f06292; padding:8px 12px; border-radius:8px; font-weight:700; }
  #home .sns-btns a:hover { background:#f48fb1; }
  #home #birthday-countdown { font-weight:bold; font-size:1.2rem; margin-bottom:10px; }
  #home #interview, #home #minigame { background:#fff; border:1px solid #f48fb1; border-radius:8px; padding:10px; color:#a188a6; font-style:italic; margin-top:10px; }

  /* íŒ¬ íƒ­ */
  #fan textarea { width:100%; height:80px; font-size:1rem; margin-bottom:8px; padding:8px; border:1px solid #f48fb1; border-radius:8px; }
  #fan button { background:#f06292; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
  #fan .letter { background:#fff; border:1px solid #f48fb1; border-radius:8px; padding:10px; margin-bottom:8px; }

  /* ê±´ì˜ íƒ­ */
  #suggestions textarea { width:100%; height:80px; font-size:1rem; padding:8px; border:1px solid #f48fb1; border-radius:8px; margin-bottom:8px; }
  #suggestions input[type=file] { margin-bottom:8px; }
  #suggestions button { background:#f06292; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }

  /* ì‹ ê³  íƒ­ inside ê±´ì˜ */
  #reports textarea { width:100%; height:80px; font-size:1rem; padding:8px; border:1px solid #f48fb1; border-radius:8px; margin-bottom:8px; }
  #reports input[type=file] { margin-bottom:8px; }
  #reports button { background:#e57373; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }

  /* ìƒì  íƒ­ */
  #shop { font-size:1rem; }
  #shop ul { list-style:none; padding:0; }
  #shop ul li { background:#fff; border:1px solid #f48fb1; border-radius:8px; margin-bottom:10px; padding:10px; display:flex; justify-content:space-between; align-items:center; }
  #shop ul li button { background:#f06292; color:#fff; border:none; padding:6px 12px; border-radius:8px; cursor:pointer; }
  #shop #strawberry-points { font-weight:bold; margin-bottom:10px; }

  /* ê´€ë¦¬ì ì˜ì—­ */
  #admin-area { background:#fce4ec; border:2px solid #f06292; padding:10px; margin-top:20px; border-radius:8px; }
  #admin-area h3 { margin-top:0; }
  #admin-area button { background:#f06292; color:#fff; border:none; padding:6px 12px; border-radius:8px; cursor:pointer; margin-bottom:8px; }

  /* ë¡œê·¸ì¸/íšŒì›ê°€ì… */
  #login-signup { max-width:400px; margin:20px auto; padding:20px; background:#fff0f6; border:1px solid #f48fb1; border-radius:12px; }
  #login-signup h2 { text-align:center; margin-bottom:20px; }
  #login-signup input { width:100%; padding:10px; margin-bottom:15px; border:1px solid #f48fb1; border-radius:8px; font-size:1rem; }
  #login-signup button { width:100%; background:#f06292; color:#fff; padding:10px; font-size:1rem; border:none; border-radius:8px; cursor:pointer; }
  #login-signup p { text-align:center; margin-top:10px; }
  #login-signup p span { color:#f06292; cursor:pointer; font-weight:bold; }

  /* í”„ë¡œí•„ ê³µìœ  QR & ë§í¬ */
  #profile-share { margin-bottom:15px; }
  #profile-share button { background:#f06292; color:#fff; border:none; padding:6px 12px; border-radius:8px; cursor:pointer; margin-right:10px; }

  /* ê¸°íƒ€ */
  .hidden { display:none !important; }
</style>
</head>
<body>

<header>
 ë¥˜ë¼ì´ íŒ¬ì‚¬ì´íŠ¸
 <div id="notice" class="hidden"></div>
</header>

<main>
  <!-- ë¡œê·¸ì¸ ë° íšŒì›ê°€ì… -->
  <section id="login-section">
    <div id="login-signup">
      <h2 id="login-title">ë¡œê·¸ì¸</h2>
      <input type="text" id="login-id" placeholder="ì•„ì´ë”” ì…ë ¥" />
      <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
      <button id="login-btn">ë¡œê·¸ì¸</button>
      <p id="to-signup">ê³„ì •ì´ ì—†ë‚˜ìš”? <span id="show-signup">íšŒì›ê°€ì…</span></p>
    </div>
  </section>

  <section id="signup-section" class="hidden">
    <div id="login-signup">
      <h2 id="signup-title">íšŒì›ê°€ì…</h2>
      <input type="text" id="signup-id" placeholder="ì‚¬ìš©í•  ì•„ì´ë””" />
      <input type="password" id="signup-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" />
      <input type="password" id="signup-pw2" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
      <button id="signup-btn">íšŒì›ê°€ì…</button>
      <p id="to-login">ì´ë¯¸ ê³„ì •ì´ ìˆë‚˜ìš”? <span id="show-login">ë¡œê·¸ì¸</span></p>
    </div>
  </section>

  <!-- ì‚¬ì´íŠ¸ ë©”ì¸ -->
  <section id="profile" class="hidden">
    <h2>ğŸŒ¸ í”„ë¡œí•„</h2>
    <label id="upload-label" for="profile-upload">í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ</label><br />
    <input type="file" id="profile-upload" accept="image/*" />
    <br />
    <img id="profile-img" src="" alt="í”„ë¡œí•„ ì´ë¯¸ì§€" style="display:none;" />
    <input type="text" id="nickname" placeholder="ë‹‰ë„¤ì„" />
    <textarea id="intro" placeholder="ì†Œê°œê¸€"></textarea>
    <button id="save-profile">ì €ì¥</button>

    <h3>ğŸ“© í¸ì§€ ê´€ë¦¬</h3>
    <select id="letter-filter">
      <option value="my">ë‚´ í¸ì§€</option>
      <option value="all">ì „ì²´ í¸ì§€ (ê´€ë¦¬ìë§Œ)</option>
    </select>
    <div id="letter-list"></div>

    <h3>ğŸ”— í”„ë¡œí•„ ê³µìœ </h3>
    <div id="profile-share">
      <button id="copy-profile-link">ë§í¬ ë³µì‚¬</button>
      <button id="generate-qr">QR ìƒì„±</button>
      <div id="qr-code" style="margin-top:10px;"></div>
    </div>

    <h3>â° ë°©ë¬¸ ì‹œê°„</h3>
    <div id="last-visit">ë§ˆì§€ë§‰ ì ‘ì† ì‹œê°„: </div>

    <h3>âš™ï¸ ê³„ì • ì„¤ì •</h3>
    <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
    <button id="delete-account-btn" style="background:#e57373; color:#fff;">íƒˆí‡´í•˜ê¸°</button>
  </section>

  <section id="home" class="hidden">
    <h2>ğŸ  í™ˆ</h2>
    <div id="birthday-countdown"></div>
    <div class="sns-btns">
      <a href="https://www.tiktok.com/@ryuraikj" target="_blank" rel="noopener noreferrer">TikTok</a>
      <a href="https://www.instagram.com/ryu_rai73/" target="_blank" rel="noopener noreferrer">Instagram</a>
      <a href="https://www.youtube.com/@rairyu1756" target="_blank" rel="noopener noreferrer">YouTube</a>
    </div>
    <p>ì´ë©”ì¼ ì£¼ì†Œ: <strong>dbalsdud6646@naver.com</strong></p>
    <h3>ë¥˜ë¼ì´ ì¸í„°ë·°</h3>
    <div id="interview" style="color:#a188a6; font-style:italic;">(ì¸í„°ë·° ê°œë°œ ì¤‘...)</div>
    <h3>ë¯¸ë‹ˆê²Œì„ &lt;ë”¸ê¸°ë¥¼ í”¼í•´ë¼!&gt;</h3>
    <div id="minigame" style="color:#a188a6; font-style:italic;">(ë¯¸ë‹ˆê²Œì„ ê°œë°œ ì¤‘...)</div>
  </section>

  <section id="fan" class="hidden">
    <h2>ğŸ’Œ íŒ¬</h2>
    <textarea id="fan-letter-content" placeholder="í¸ì§€ ì‘ì„± (ê¾¸ë¯¸ê¸° ê¸°ëŠ¥ ê°œë°œ ì¤‘)"></textarea>
    <button id="fan-letter-submit">í¸ì§€ ë³´ë‚´ê¸°</button>
    <div id="fan-letter-list"></div>
  </section>

  <section id="suggestions" class="hidden">
    <h2>ğŸ›  ê±´ì˜í•˜ê¸°</h2>
    <textarea id="suggestion-content" placeholder="ê±´ì˜ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea><br />
    <input type="file" id="suggestion-file" accept="image/*" /><br />
    <button id="suggestion-submit">ê±´ì˜í•˜ê¸° ì œì¶œ</button>

    <h2>ğŸš¨ ì‹ ê³ í•˜ê¸°</h2>
    <textarea id="report-content" placeholder="ì‹ ê³  ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš” (ì‚¬ì§„ ì²¨ë¶€ í•„ìˆ˜)"></textarea><br />
    <input type="file" id="report-file" accept="image/*" /><br />
    <button id="report-submit">ì‹ ê³ í•˜ê¸° ì œì¶œ</button>
  </section>

  <section id="shop" class="hidden">
    <h2>ğŸ› ìƒì </h2>
    <div id="strawberry-points">ë”¸ê¸° í¬ì¸íŠ¸: 0</div>
    <ul id="shop-items">
      <li>
        í¸ì§€ìš© ë”¸ê¸° ìŠ¤í‹°ì»¤
        <button data-item="sticker" class="buy-btn">êµ¬ë§¤</button>
      </li>
      <li>
        ë ˆì´ìŠ¤ ê¾¸ë¯¸ê¸°
        <button data-item="lace" class="buy-btn">êµ¬ë§¤</button>
      </li>
      <li>
        í¸ì§€ ì‘ì„±ê¶Œ +1
        <button data-item="write-pass" class="buy-btn">êµ¬ë§¤</button>
      </li>
      <li>
        ë¶€í™œ 1íšŒê¶Œ (ê²Œì„ ì—°ë™)
        <button data-item="revive" class="buy-btn">êµ¬ë§¤</button>
      </li>
    </ul>

    <div id="admin-area" class="hidden">
      <h3>ğŸ‘‘ ê´€ë¦¬ì ì „ìš©</h3>
      <button id="admin-view-letters">ì „ì²´ í¸ì§€ ì—´ëŒ</button><br />
      <button id="admin-view-suggestions">ì „ì²´ ê±´ì˜ ì—´ëŒ</button><br />
      <button id="admin-view-reports">ì „ì²´ ì‹ ê³  ì—´ëŒ</button><br />
      <button id="admin-view-users">ìœ ì € ëª©ë¡ í™•ì¸</button><br />
      <button id="admin-give-strawberry">ë”¸ê¸° í¬ì¸íŠ¸ ì§€ê¸‰</button><br />
      <button id="admin-post-notice">ê³µì§€ ì‘ì„±</button><br />
    </div>
  </section>

</main>

<nav>
  <button id="tab-profile" class="active">í”„ë¡œí•„</button>
  <button id="tab-home">í™ˆ</button>
  <button id="tab-fan">íŒ¬</button>
  <button id="tab-suggestions">ê±´ì˜</button>
  <button id="tab-shop">ìƒì </button>
</nav>

<!-- QR ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ (ê°„ë‹¨íˆ êµ¬ê¸€ CDN) -->
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
(() => {
  // ====== ë°ì´í„° ì €ì¥ ======
  const STORAGE_KEYS = {
    USERS: 'ryu_users',
    CURRENT_USER: 'ryu_current_user',
    LETTERS: 'ryu_letters',
    SUGGESTIONS: 'ryu_suggestions',
    REPORTS: 'ryu_reports',
    POINTS: 'ryu_points',
    NOTICES: 'ryu_notices',
  };

  // ====== UI ìš”ì†Œ ì°¾ê¸° ======
  const loginSection = document.getElementById('login-section');
  const signupSection = document.getElementById('signup-section');
  const profileSection = document.getElementById('profile');
  const homeSection = document.getElementById('home');
  const fanSection = document.getElementById('fan');
  const suggestionsSection = document.getElementById('suggestions');
  const shopSection = document.getElementById('shop');

  // âœ… ì´ˆê¸°í™”: í˜ì´ì§€ ì—´ì—ˆì„ ë•Œ ë¡œê·¸ì¸ í™”ë©´ë§Œ ë³´ì´ê²Œ
  window.onload = function () {
    loginSection.style.display = 'block';
    signupSection.style.display = 'none';
    profileSection.style.display = 'none';
    homeSection.style.display = 'none';
    fanSection.style.display = 'none';
    suggestionsSection.style.display = 'none';
    shopSection.style.display = 'none';
  };

function loginSuccess() {
  loginSection.style.display = 'none';
  signupSection.style.display = 'none';
  showSection('home');  // ë¡œê·¸ì¸ í›„ í™ˆ í™”ë©´ ë³´ì—¬ì¤Œ
}


  // ì´ˆê¸° ìœ ì € ëª©ë¡ - ë§¤ë‹ˆì €/ê´€ë¦¬ì/ì¼ë°˜ ë©¤ë²„(ê°€ì…ì‹œ ì¶”ê°€)
  let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS)) || [
    {id:'manager', password:'managerpass', role:'manager', nickname:'ë¥˜ë¼ì´ ë§¤ë‹ˆì €', intro:'ì‚¬ì´íŠ¸ ìµœê³  ê´€ë¦¬ìì…ë‹ˆë‹¤.', profileImg:'', lastVisit:null, strawberryPoints: 9999},
    {id:'admin', password:'adminpass', role:'admin', nickname:'ë¥˜ë¼ì´ ê´€ë¦¬ì', intro:'ì‚¬ì´íŠ¸ ê´€ë¦¬ìì…ë‹ˆë‹¤.', profileImg:'', lastVisit:null, strawberryPoints: 100},
  ];

  // í˜„ì¬ ë¡œê·¸ì¸ ìœ ì €
  let currentUser = JSON.parse(localStorage.getItem(STORAGE_KEYS.CURRENT_USER)) || null;

  // í¸ì§€, ê±´ì˜, ì‹ ê³  ì €ì¥ì†Œ
  let letters = JSON.parse(localStorage.getItem(STORAGE_KEYS.LETTERS)) || [];
  let suggestions = JSON.parse(localStorage.getItem(STORAGE_KEYS.SUGGESTIONS)) || [];
  let reports = JSON.parse(localStorage.getItem(STORAGE_KEYS.REPORTS)) || [];

  // ê³µì§€ì‚¬í•­ (í•˜ë‹¨ í—¤ë”ì— í‘œì‹œ)
  let notices = JSON.parse(localStorage.getItem(STORAGE_KEYS.NOTICES)) || [];

  // ë”¸ê¸° í¬ì¸íŠ¸ (ì‚¬ìš©ìë³„ ì €ì¥)
  function saveUsers() {
    localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
  }
  function saveCurrentUser() {
    localStorage.setItem(STORAGE_KEYS.CURRENT_USER, JSON.stringify(currentUser));
  }
  function saveLetters() {
    localStorage.setItem(STORAGE_KEYS.LETTERS, JSON.stringify(letters));
  }
  function saveSuggestions() {
    localStorage.setItem(STORAGE_KEYS.SUGGESTIONS, JSON.stringify(suggestions));
  }
  function saveReports() {
    localStorage.setItem(STORAGE_KEYS.REPORTS, JSON.stringify(reports));
  }
  function saveNotices() {
    localStorage.setItem(STORAGE_KEYS.NOTICES, JSON.stringify(notices));
  }

  // ====== UI ìš”ì†Œ ======
  const loginSection = document.getElementById('login-section');
  const signupSection = document.getElementById('signup-section');
  const profileSection = document.getElementById('profile');
  const homeSection = document.getElementById('home');
  const fanSection = document.getElementById('fan');
  const suggestionsSection = document.getElementById('suggestions');
  const shopSection = document.getElementById('shop');

  const navButtons = {
    profile: document.getElementById('tab-profile'),
    home: document.getElementById('tab-home'),
    fan: document.getElementById('tab-fan'),
    suggestions: document.getElementById('tab-suggestions'),
    shop: document.getElementById('tab-shop'),
  };

  // ë¡œê·¸ì¸ UI
  const loginTitle = document.getElementById('login-title');
  const loginIdInput = document.getElementById('login-id');
  const loginPwInput = document.getElementById('login-pw');
  const loginBtn = document.getElementById('login-btn');
  const toSignupBtn = document.getElementById('to-signup-btn');

  // íšŒì›ê°€ì… UI
  const signupIdInput = document.getElementById('signup-id');
  const signupPwInput = document.getElementById('signup-pw');
  const signupBtn = document.getElementById('signup-btn');
  const toLoginBtn = document.getElementById('to-login-btn');

  // í”„ë¡œí•„ íƒ­ UI
  const profileUploadInput = document.getElementById('profile-upload');
  const profileImg = document.getElementById('profile-img');
  const nicknameInput = document.getElementById('nickname');
  const introInput = document.getElementById('intro');
  const saveProfileBtn = document.getElementById('save-profile');

  // í¸ì§€ ê´€ë¦¬
  const letterFilter = document.getElementById('letter-filter');
  const letterList = document.getElementById('letter-list');

  // í”„ë¡œí•„ ê³µìœ 
  const copyProfileLinkBtn = document.getElementById('copy-profile-link');
  const generateQRBtn = document.getElementById('generate-qr');
  const qrCodeDiv = document.getElementById('qr-code');

  // ë°©ë¬¸ ì‹œê°„
  const lastVisitDiv = document.getElementById('last-visit');

  // ê³„ì • ì„¤ì •
  const logoutBtn = document.getElementById('logout-btn');
  const deleteAccountBtn = document.getElementById('delete-account-btn');

  // í™ˆ íƒ­ UI
  const birthdayCountdownDiv = document.getElementById('birthday-countdown');
  const interviewDiv = document.getElementById('interview');
  const minigameDiv = document.getElementById('minigame');

  // íŒ¬ íƒ­ UI
  const fanLetterContent = document.getElementById('fan-letter-content');
  const fanLetterSubmit = document.getElementById('fan-letter-submit');
  const fanLetterList = document.getElementById('fan-letter-list');

  // ê±´ì˜ íƒ­ UI
  const suggestionContent = document.getElementById('suggestion-content');
  const suggestionFile = document.getElementById('suggestion-file');
  const suggestionSubmit = document.getElementById('suggestion-submit');
  const reportContent = document.getElementById('report-content');
  const reportFile = document.getElementById('report-file');
  const reportSubmit = document.getElementById('report-submit');

  // ìƒì  íƒ­ UI
  const strawberryPointsDiv = document.getElementById('strawberry-points');
  const shopItemsList = document.getElementById('shop-items');
  const adminArea = document.getElementById('admin-area');

  // ê´€ë¦¬ì ì „ìš© ë²„íŠ¼
  const adminViewLettersBtn = document.getElementById('admin-view-letters');
  const adminViewSuggestionsBtn = document.getElementById('admin-view-suggestions');
  const adminViewReportsBtn = document.getElementById('admin-view-reports');
  const adminViewUsersBtn = document.getElementById('admin-view-users');
  const adminGiveStrawberryBtn = document.getElementById('admin-give-strawberry');
  const adminPostNoticeBtn = document.getElementById('admin-post-notice');

  // ====== í•¨ìˆ˜ ======

  // ë¡œê·¸ì¸ ìƒíƒœ UI ì„¤ì •
  function setLoginUI() {
    if (currentUser) {
      loginSection.classList.add('hidden');
      signupSection.classList.add('hidden');
      showSection('profile');
      updateLastVisit();
      loadProfile();
      updateStrawberryPoints();
      checkAdminAccess();
    } else {
      loginSection.classList.remove('hidden');
      signupSection.classList.add('hidden');
      profileSection.classList.add('hidden');
      homeSection.classList.add('hidden');
      fanSection.classList.add('hidden');
      suggestionsSection.classList.add('hidden');
      shopSection.classList.add('hidden');
    }
  }

function hideAllSections() {
  profileSection.style.display = 'none';
  homeSection.style.display = 'none';
  fanSection.style.display = 'none';
  suggestionsSection.style.display = 'none';
  shopSection.style.display = 'none';
}
function showSection(name) {
  hideAllSections();
  if (name === 'profile') profileSection.style.display = 'block';
  else if (name === 'home') homeSection.style.display = 'block';
  else if (name === 'fan') fanSection.style.display = 'block';
  else if (name === 'suggestions') suggestionsSection.style.display = 'block';
  else if (name === 'shop') shopSection.style.display = 'block';
}

navButtons.profile.addEventListener('click', () => showSection('profile'));
navButtons.home.addEventListener('click', () => showSection('home'));
navButtons.fan.addEventListener('click', () => showSection('fan'));
navButtons.suggestions.addEventListener('click', () => showSection('suggestions'));
navButtons.shop.addEventListener('click', () => showSection('shop'));

  // íƒ­ í‘œì‹œ ì „í™˜
  function showSection(section) {
    profileSection.classList.add('hidden');
    homeSection.classList.add('hidden');
    fanSection.classList.add('hidden');
    suggestionsSection.classList.add('hidden');
    shopSection.classList.add('hidden');
    navButtons.profile.classList.remove('active');
    navButtons.home.classList.remove('active');
    navButtons.fan.classList.remove('active');
    navButtons.suggestions.classList.remove('active');
    navButtons.shop.classList.remove('active');

    switch (section) {
      case 'profile': profileSection.classList.remove('hidden'); navButtons.profile.classList.add('active'); break;
      case 'home': homeSection.classList.remove('hidden'); navButtons.home.classList.add('active'); break;
      case 'fan': fanSection.classList.remove('hidden'); navButtons.fan.classList.add('active'); break;
      case 'suggestions': suggestionsSection.classList.remove('hidden'); navButtons.suggestions.classList.add('active'); break;
      case 'shop': shopSection.classList.remove('hidden'); navButtons.shop.classList.add('active'); break;
    }
  }

  // ë‹‰ë„¤ì„, ì†Œê°œê¸€, í”„ë¡œí•„ ì´ë¯¸ì§€ ë¡œë“œ
  function loadProfile() {
    if (!currentUser) return;
    nicknameInput.value = currentUser.nickname || '';
    introInput.value = currentUser.intro || '';
    if (currentUser.profileImg) {
      profileImg.src = currentUser.profileImg;
      profileImg.style.display = 'block';
    } else {
      profileImg.style.display = 'none';
    }
  }

  // í”„ë¡œí•„ ì €ì¥
  saveProfileBtn.addEventListener('click', () => {
    if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    currentUser.nickname = nicknameInput.value.trim();
    currentUser.intro = introInput.value.trim();
    saveUsers();
    saveCurrentUser();
    alert('í”„ë¡œí•„ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
  });

  // í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
  profileUploadInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      if (!currentUser) return;
      currentUser.profileImg = reader.result;
      profileImg.src = reader.result;
      profileImg.style.display = 'block';
      saveUsers();
      saveCurrentUser();
    };
    reader.readAsDataURL(file);
  });

  // í¸ì§€ í•„í„° ë³€ê²½ ë° ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
  letterFilter.addEventListener('change', () => {
    loadLetters();
  });

  // í¸ì§€ ë¡œë“œ
  function loadLetters() {
    letterList.innerHTML = '';
    if (!currentUser) return;
    const filter = letterFilter.value;
    let filteredLetters = [];
    if (filter === 'my') {
      filteredLetters = letters.filter(l => l.authorId === currentUser.id);
    } else if (filter === 'all') {
      if (currentUser.role === 'admin' || currentUser.role === 'manager') {
        filteredLetters = letters;
      } else {
        alert('ì „ì²´ í¸ì§€ ì—´ëŒ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        letterFilter.value = 'my';
        filteredLetters = letters.filter(l => l.authorId === currentUser.id);
      }
    }
    if (filteredLetters.length === 0) {
      letterList.innerHTML = '<p>í¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }
    filteredLetters.forEach(letter => {
      const letterDiv = document.createElement('div');
      letterDiv.className = 'letter-item';
      letterDiv.textContent = `[${letter.authorNickname}] ${letter.content}`;
      // ë³¸ì¸ í¸ì§€ë©´ ìˆ˜ì •, ì‚­ì œ ë²„íŠ¼
      if (letter.authorId === currentUser.id) {
        const editBtn = document.createElement('button');
        editBtn.textContent = 'ìˆ˜ì •';
        editBtn.style.marginLeft = '5px';
        editBtn.onclick = () => {
          const newContent = prompt('í¸ì§€ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”:', letter.content);
          if (newContent !== null) {
            letter.content = newContent.trim();
            saveLetters();
            loadLetters();
          }
        };
        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = 'ì‚­ì œ';
        deleteBtn.style.marginLeft = '5px';
        deleteBtn.onclick = () => {
          if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            letters = letters.filter(l => l.id !== letter.id);
            saveLetters();
            loadLetters();
          }
        };
        letterDiv.appendChild(editBtn);
        letterDiv.appendChild(deleteBtn);
      }
      letterList.appendChild(letterDiv);
    });
  }

  // í”„ë¡œí•„ ê³µìœ  - ë§í¬ ë³µì‚¬
  copyProfileLinkBtn.addEventListener('click', () => {
    if (!currentUser) return;
    const profileLink = location.href + '?user=' + encodeURIComponent(currentUser.id);
    navigator.clipboard.writeText(profileLink).then(() => {
      alert('í”„ë¡œí•„ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });
  });

  // í”„ë¡œí•„ ê³µìœ  - QR ì½”ë“œ ìƒì„±
  generateQRBtn.addEventListener('click', () => {
    if (!currentUser) return;
    const profileLink = location.href + '?user=' + encodeURIComponent(currentUser.id);
    qrCodeDiv.innerHTML = '';
    QRCode.toCanvas(profileLink, {width: 128}, (error, canvas) => {
      if (error) {
        alert('QR ì½”ë“œ ìƒì„± ì‹¤íŒ¨');
        return;
      }
      qrCodeDiv.appendChild(canvas);
    });
  });

  // ë°©ë¬¸ ì‹œê°„ ì—…ë°ì´íŠ¸
  function updateLastVisit() {
    if (!currentUser) return;
    currentUser.lastVisit = new Date().toISOString();
    saveUsers();
    saveCurrentUser();
    lastVisitDiv.textContent = 'ë§ˆì§€ë§‰ ì ‘ì† ì‹œê°„: ' + new Date(currentUser.lastVisit).toLocaleString();
  }

  // ë¡œê·¸ì•„ì›ƒ
  logoutBtn.addEventListener('click', () => {
    currentUser = null;
    saveCurrentUser();
    alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
    setLoginUI();
  });

  // íƒˆí‡´í•˜ê¸°
  deleteAccountBtn.addEventListener('click', () => {
    if (!currentUser) return;
    if (!confirm('ì •ë§ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ê³„ì •ê³¼ ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë©ë‹ˆë‹¤.')) return;
    // ê´€ë¦¬ìë‚˜ ë§¤ë‹ˆì € íƒˆí‡´ ë¶ˆê°€
    if (currentUser.role === 'manager') {
      alert('ë§¤ë‹ˆì € ê³„ì •ì€ íƒˆí‡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }
    if (currentUser.role === 'admin') {
      alert('ê´€ë¦¬ì ê³„ì •ì€ íƒˆí‡´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }
    // íšŒì› ì •ë³´ ì‚­ì œ
    users = users.filter(u => u.id !== currentUser.id);
    // ê´€ë ¨ í¸ì§€ ì‚­ì œ
    letters = letters.filter(l => l.authorId !== currentUser.id);
    saveLetters();
    saveUsers();
    currentUser = null;
    saveCurrentUser();
    alert('íƒˆí‡´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
    setLoginUI();
  });

  // í™ˆ íƒ­ - ìƒì¼ ë””ë°ì´ ê³„ì‚°
  function updateBirthdayCountdown() {
    const now = new Date();
    const year = now.getFullYear();
    let birthday = new Date(year, 8, 16); // 9ì›” 16ì¼ (0-based ì›”)
    if (birthday < now) birthday.setFullYear(year + 1);
    const diff = birthday - now;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    birthdayCountdownDiv.textContent = `ë¥˜ë¼ì´ ìƒì¼ê¹Œì§€ ${days}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤! ğŸ‰`;
  }

  setInterval(updateBirthdayCountdown, 1000 * 60);
  updateBirthdayCountdown();

  // íŒ¬ íƒ­ - í¸ì§€ ì‘ì„±
  fanLetterSubmit.addEventListener('click', () => {
    if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    const content = fanLetterContent.value.trim();
    if (!content) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
    const newLetter = {
      id: 'letter_' + Date.now(),
      authorId: currentUser.id,
      authorNickname: currentUser.nickname || currentUser.id,
      content,
      date: new Date().toISOString(),
    };
    letters.push(newLetter);
    saveLetters();
    fanLetterContent.value = '';
    alert('í¸ì§€ê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
    loadFanLetters();
  });

  // íŒ¬ í¸ì§€ ë¡œë“œ (ê´€ë¦¬ì/ë§¤ë‹ˆì €ëŠ” ì „ì²´ í¸ì§€)
  function loadFanLetters() {
    fanLetterList.innerHTML = '';
    if (!currentUser) return;
    let displayLetters = [];
    if (currentUser.role === 'admin' || currentUser.role === 'manager') {
      displayLetters = letters;
    } else {
      displayLetters = letters.filter(l => l.authorId === currentUser.id);
    }
    if (displayLetters.length === 0) {
      fanLetterList.innerHTML = '<p>í¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
      return;
    }
    displayLetters.forEach(letter => {
      const div = document.createElement('div');
      div.textContent = `[${letter.authorNickname}] ${letter.content}`;
      fanLetterList.appendChild(div);
    });
  }

  // ê±´ì˜í•˜ê¸° ì œì¶œ
  suggestionSubmit.addEventListener('click', () => {
    if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    const content = suggestionContent.value.trim();
    if (!content) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
    let imgData = null;
    const file = suggestionFile.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        imgData = reader.result;
        addSuggestion(content, imgData);
      };
      reader.readAsDataURL(file);
    } else {
      addSuggestion(content, null);
    }
  });

  function addSuggestion(content, imgData) {
    const newSuggestion = {
      id: 'suggestion_' + Date.now(),
      authorId: currentUser.id,
      authorNickname: currentUser.nickname || currentUser.id,
      content,
      imgData,
      date: new Date().toISOString(),
    };
    suggestions.push(newSuggestion);
    saveSuggestions();
    suggestionContent.value = '';
    suggestionFile.value = '';
    alert('ê±´ì˜ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  // ì‹ ê³ í•˜ê¸° ì œì¶œ
  reportSubmit.addEventListener('click', () => {
    if (!currentUser) return alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    const content = reportContent.value.trim();
    if (!content) return alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
    const file = reportFile.files[0];
    if (!file) return alert('ì¦ë¹™ íŒŒì¼ì„ ì²¨ë¶€í•˜ì„¸ìš”.');
    const reader = new FileReader();
    reader.onload = () => {
      const imgData = reader.result;
      addReport(content, imgData);
    };
    reader.readAsDataURL(file);
  });

  function addReport(content, imgData) {
    const newReport = {
      id: 'report_' + Date.now(),
      authorId: currentUser.id,
      authorNickname: currentUser.nickname || currentUser.id,
      content,
      imgData,
      date: new Date().toISOString(),
    };
    reports.push(newReport);
    saveReports();
    reportContent.value = '';
    reportFile.value = '';
    alert('ì‹ ê³ ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
  }

  // ìƒì  íƒ­ - ë”¸ê¸° í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
  function updateStrawberryPoints() {
    if (!currentUser) return;
    strawberryPointsDiv.textContent = `ë”¸ê¸° í¬ì¸íŠ¸: ${currentUser.strawberryPoints || 0}`;
  }

  // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
  function checkAdminAccess() {
    if (!currentUser) return;
    if (currentUser.role === 'admin' || currentUser.role === 'manager') {
      adminArea.style.display = 'block';
    } else {
      adminArea.style.display = 'none';
    }
  }

  // ====== ì´ˆê¸°í™” ======

  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  function loadUsers() {
    const data = localStorage.getItem('users');
    if (data) users = JSON.parse(data);
  }
  function loadLetters() {
    const data = localStorage.getItem('letters');
    if (data) letters = JSON.parse(data);
  }
  function loadSuggestions() {
    const data = localStorage.getItem('suggestions');
    if (data) suggestions = JSON.parse(data);
  }
  function loadReports() {
    const data = localStorage.getItem('reports');
    if (data) reports = JSON.parse(data);
  }
  function loadCurrentUser() {
    const data = localStorage.getItem('currentUser');
    if (data) currentUser = JSON.parse(data);
  }

  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥
  function saveUsers() {
    localStorage.setItem('users', JSON.stringify(users));
  }
  function saveLetters() {
    localStorage.setItem('letters', JSON.stringify(letters));
  }
  function saveSuggestions() {
    localStorage.setItem('suggestions', JSON.stringify(suggestions));
  }
  function saveReports() {
    localStorage.setItem('reports', JSON.stringify(reports));
  }
  function saveCurrentUser() {
    if (currentUser) {
      localStorage.setItem('currentUser', JSON.stringify(currentUser));
    } else {
      localStorage.removeItem('currentUser');
    }
  }

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
  window.addEventListener('load', () => {
    loadUsers();
    loadLetters();
    loadSuggestions();
    loadReports();
    loadCurrentUser();
    setLoginUI();
    loadLetters();
    loadFanLetters();
  });

  // ====== ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ======

  navButtons.profile.addEventListener('click', () => showSection('profile'));
  navButtons.home.addEventListener('click', () => showSection('home'));
  navButtons.fan.addEventListener('click', () => showSection('fan'));
  navButtons.suggestions.addEventListener('click', () => showSection('suggestions'));
  navButtons.shop.addEventListener('click', () => showSection('shop'));

  // ë¡œê·¸ì¸ ë²„íŠ¼ ì´ë²¤íŠ¸
  loginBtn.addEventListener('click', () => {
    const id = loginIdInput.value.trim();
    const pw = loginPwInput.value.trim();
    if (!id || !pw) return alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    const user = users.find(u => u.id === id && u.pw === pw);
    if (!user) return alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
    currentUser = user;
    saveCurrentUser();
    setLoginUI();
  });

  // íšŒì›ê°€ì… ë²„íŠ¼ ì´ë²¤íŠ¸
  toSignupBtn.addEventListener('click', () => {
    loginSection.classList.add('hidden');
    signupSection.classList.remove('hidden');
  });

  signupBtn.addEventListener('click', () => {
    const id = signupIdInput.value.trim();
    const pw = signupPwInput.value.trim();
    if (!id || !pw) return alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
    if (users.find(u => u.id === id)) return alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
    const newUser = {
      id,
      pw,
      nickname: '',
      intro: '',
      profileImg: null,
      role: 'member',
      strawberryPoints: 0,
      lastVisit: null,
    };
    users.push(newUser);
    saveUsers();
    alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•˜ì„¸ìš”.');
    signupSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
  });

  toLoginBtn.addEventListener('click', () => {
    signupSection.classList.add('hidden');
    loginSection.classList.remove('hidden');
  });

  // í˜ì´ì§€ ì§„ì… ì‹œ URL ì¿¼ë¦¬ë¡œ í”„ë¡œí•„ ë³´ì—¬ì£¼ê¸° (ì˜ˆ: ?user=someId)
  function showProfileFromQuery() {
    const params = new URLSearchParams(window.location.search);
    const userId = params.get('user');
    if (!userId) return;
    const user = users.find(u => u.id === userId);
    if (!user) return;
    // í”„ë¡œí•„ íƒ­ìœ¼ë¡œ ì´ë™
    showSection('profile');
    // í”„ë¡œí•„ ì •ë³´ í‘œì‹œ (ì½ê¸° ì „ìš©)
    nicknameInput.value = user.nickname || '';
    introInput.value = user.intro || '';
    nicknameInput.disabled = true;
    introInput.disabled = true;
    profileUploadInput.disabled = true;
    saveProfileBtn.disabled = true;
    if (user.profileImg) {
      profileImg.src = user.profileImg;
      profileImg.style.display = 'block';
    } else {
      profileImg.style.display = 'none';
    }
  }
  showProfileFromQuery();íŒ¬ì‚¬ì´íŠ¸ ì½”ë“œì™€ ë™ì‘ ì„¤ëª… ì˜ ì •ë¦¬í•´ì£¼ì…¨ë„¤ìš”!  
í˜„ì¬ê¹Œì§€ ì‘ì„±í•œ ì½”ë“œ êµ¬ì¡°ê°€ ì‚¬ìš©ìì˜ ë¡œê·¸ì¸/íšŒì›ê°€ì…, í”„ë¡œí•„ í¸ì§‘, í¸ì§€Â·ê±´ì˜Â·ì‹ ê³  ì‘ì„± ë° ëª©ë¡ í‘œì‹œ, ê·¸ë¦¬ê³  ë”¸ê¸° í¬ì¸íŠ¸ í‘œì‹œì™€ ê´€ë¦¬ì ê¶Œí•œ ì²´í¬ê¹Œì§€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

ëª‡ ê°€ì§€ ì¶”ê°€ ì œì•ˆ ë° í™•ì¸ì‚¬í•­ ë“œë¦´ê²Œìš”.

---

### 1. ê¶Œí•œ ì²´í¬ ë° ê´€ë¦¬ì ì˜ì—­ ë³´ì´ê¸°/ìˆ¨ê¸°ê¸°

```js
function checkAdminAccess() {
  if (!currentUser) return;
  if (currentUser.role === 'admin' || currentUser.role === 'manager') {
    adminArea.style.display = 'block';
  } else {
    adminArea.style.display = 'none';
  }
}
